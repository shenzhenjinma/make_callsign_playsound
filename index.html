<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>摩尔斯电码声音生成器</title>
</head>
<body>
    <h1>摩尔斯电码声音生成器</h1>
    <button onclick="playMorseCodes()">播放摩尔斯电码</button>
    <label for="speed">速度:</label>
    <input type="range" min="0.1" max="2" step="0.1" value="1" id="speed" onchange="changeSpeed()">
    <span id="speedValue">1</span>
    <div id="callsignList" style="height: 200px; overflow-y: scroll; border: 1px solid #000;"></div>

    <script>
        var audioContext = new (window.AudioContext || window.webkitAudioContext)();
        var gainNode = audioContext.createGain();
        gainNode.connect(audioContext.destination);
        gainNode.gain.value = 0.1; // 音量控制
        var unitTime = 100; // 每个摩尔斯电码单元时间（毫秒）
        var frequency = 600; // 声音频率（Hz）
        var speed = 1; // 默认速度
        var callsigns = [];

        function generateCallsign() {
            var callsign = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            var length = 6;
            for (var i = 0; i < length; i++) {
                callsign += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return callsign;
        }

        function generateCallsigns() {
            callsigns = [];
            for (var i = 0; i < 50; i++) {
                callsigns.push(generateCallsign());
            }
        }

        async function playMorseCodes() {
            generateCallsigns();
            for (let i = 0; i < callsigns.length; i++) {
                await playMorseCode(callsigns[i]);
                await new Promise(resolve => setTimeout(resolve, 2000)); // 等待2秒
            }
        }

        function playMorseCode(callsign) {
            return new Promise(async resolve => {
                var morseCode = convertToMorseCode(callsign);
                addCallsignToList(callsign);

                for (const symbol of morseCode.split('')) {
                    switch (symbol) {
                        case ".":
                            playSound(1);
                            await sleep(unitTime / speed);
                            break;
                        case "-":
                            playSound(3);
                            await sleep(3 * unitTime / speed);
                            break;
                        case " ":
                            await sleep(unitTime / speed); // 字符之间的间隔
                            break;
                        case "/":
                            await sleep(7 * unitTime / speed); // 单词之间的间隔
                            break;
                    }
                    await sleep(unitTime / speed); // 每个符号之后的间隔
                }

                resolve();
            });
        }

        function playSound(duration) {
            var oscillator = audioContext.createOscillator();
            oscillator.connect(gainNode);
            oscillator.type = "sine"; // 振荡器类型为正弦波
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration * unitTime / 1000 / speed);
        }

        function changeSpeed() {
            speed = parseFloat(document.getElementById('speed').value);
            document.getElementById('speedValue').innerText = speed.toFixed(1);
        }

        function convertToMorseCode(text) {
            var morseCode = '';
            var morseAlphabet = {
                'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 'G': '--.', 'H': '....',
                'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 'O': '---', 'P': '.--.',
                'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-',
                'Y': '-.--', 'Z': '--..',
                '0': '-----', '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....', '6': '-....',
                '7': '--...', '8': '---..', '9': '----.'
            };

            for (var i = 0; i < text.length; i++) {
                var character = text[i].toUpperCase();
                if (morseAlphabet[character]) {
                    morseCode += morseAlphabet[character] + ' ';
                } else {
                    morseCode += '/ ';
                }
            }

            return morseCode.trim();
        }

        function addCallsignToList(callsign) {
            var callsignList = document.getElementById('callsignList');
            var callsignElement = document.createElement('div');
            callsignElement.innerText = '呼号: ' + callsign;
            callsignList.appendChild(callsignElement);
            callsignList.scrollTop = callsignList.scrollHeight;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
